<html>

<head>
    <link rel="icon" type="image/x-icon" href="https://eolo.zeromist.net/images/g2.png">
    <title>Copertura Eolo</title>
    <link rel="stylesheet" href="css/style.css?234244534554342424334334">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="./dist/MarkerCluster.css" />
    <link rel="stylesheet" href="./dist/MarkerCluster.Default.css" />

</head>

<body>
        
        
        <div class="topmenu">

            <p style="color: black; font-weight: bold;">Mappa copertura FWA EOLO</p>
            <div style="padding-left: 2%;"></div>
            <input type="text" class="input" placeholder="Nome/ID BTS" id="input">

            <div style="padding-left: 5vw;" ></div>
            <p class = "topinfonumber">Settori: </p>
            <div style="padding-left: 4;" ></div>
            <p id="sectorcomplete" class = "topinfonumber"></p>
            <div style="padding-left: 25;" ></div>
            <p class = "topinfonumber">Heatmap: </p>
            <div style="padding-left: 4;" ></div>
            <p id="heatmapcomplete" class = "topinfonumber"></p>
            <div style="padding-left: 4%;" ></div>
            <button type="submit" class="hideshow">
                <img src="pngs/hideshow.png" alt="buttonpng" border="0" class="hideshow" style="opacity: 0.7;" />
            </button>
            <button type="submit" class="info">
                <img src="pngs/information.png" alt="buttonpng" border="0" class="info" style="opacity: 0.7;" />
            </button>
        </div>
        <div class="rightmenu" id="rightmenu">

            <div class="container">
                <div class="row">
                    <p>Informazioni BTS</p>
                </div>
                <div class="row">
                    <div class="col1">
                        <p>Nome</p>
                    </div>
                    <div class="col2" id="name"></div>
                </div>
                <div class="row">
                    <div class="col1">
                        <p>Id</p>
                    </div>
                    <div class="col2" id="id"></div>
                </div>
                <div class="row">
                    <div class="col1">
                        <p>Lat</p>
                    </div>
                    <div class="col2" id="lat"></div>
                </div>
                <div class="row">
                    <div class="col1">
                        <p>Lon</p>
                    </div>
                    <div class="col2" id="lng"></div>
                </div>
                <div class="row">
                    <div class="col1">
                        <p>Tecno</p>
                    </div>
                    <div class="col2" id="tecno"></div>
                </div>
                <div class="row">
                    <div class="col1">
                        <p>Settori</p>
                    </div>
                    <div class="col2" id="sec"></div>
                </div>
                
            </div>
            <div class="legenda" id="legenda">


            <div class="container">
                <div class="row">
                    <p>Legenda settori</p>
                </div>
                <div class="row">
                    <div class="collegend">
                        <img src="pngs/legend_red.png" alt="Italian Trulli" style="height:calc(10px + 0.3vw)">
                    </div>
                    <div class="collegend" id="lat"></div>
                    
                    <p>Eolowave (tecno1)</p>
                </div>
                <div >
                    <div class="collegend">
                        <img src="pngs/legend_green.png" alt="Italian Trulli" style="height:calc(10px + 0.3vw)">
                    </div>
                    <div class="collegend" id="lat"></div>
                    
                    <p>Eolowave G (tecno2)</p>
                </div>
                <div class="row">
                    <div class="collegend">
                        <img src="pngs/legend_blue.png" alt="Italian Trulli" style="height:calc(10px + 0.3vw)">
                    </div>
                    <div class="collegend" id="lat"></div>
                    
                    <p>Eolowave + Eolowave G (tecno3)</p>
                </div>
            </div>
            </div>
        </div>

    <div>

    </div>

    <div style="  align-items: start;justify-content: center;  display: flex; align-items: start;display:inline-flex;">

        <div class="menu" id="menu" style="position:fixed;position:fixed;">
            <p style="margin-top: 0; padding: 0;font-size: 12;"></p>
        </div>
    </div>
    <div id="map"></div>
    <!--<iframe src="getreport.html" height="700" width="500" class="report"></iframe>-->
    <div class="report">
        <div>
            <p style="font-family: Arial, Helvetica, sans-serif;display: inline-block;">Report</p>
            <button id="closereport" style="left: 50;">X</button>
        </div>
        
        <ul id ="lista">
            
        </ul>
    </div>

    <div id="popup-window">
        <div >
        <p class="texttitle" style="font-size: 25;">Spieghino</p>
        <p class="texttitle" style="padding-top: 0;">Premessa</p>
        <p class="textinfo">Le informazioni messe a disposizione nel sito sono da considerarsi una simulazione di quelle
            che sono le coperture reali, con le dovute approssimazioni, supposizioni ed errori temporali. &#232;
            consigliato utilizzare il sito per delle verifiche di massima, per farsi un idea della situazione
            orografica del territorio e per informazioni generali sulle BTS. &#200; sempre consigliato fare 
            riferimento ai dati ufficiali per chiarimenti.
        </p>
        <p class="texttitle">Come sono stati ottenuti i dati?</p>
        <p class="textinfo">Se per le posizioni delle BTS e la tecnologia offerta &#232; facile recuperare tutte le posizioni (diversi siti di copertura hanno
            API libere e questo dato viene offerto in chiaro), questo non si puo dire per i settori e per l'altezza delle antenne (dato fondamentale per calcolare l'area
            con visibilit&#224; e quindi coperta).<br>L'altezza delle BTS ha richiesto un lavoro immane di trigonometria e pazienza. Sapendo la posizione della BTS, si puo
            ricavare l'altezza in base all'ombra proiettata a terra sulle foto satellitari. In questo caso &#232; stato utilizzato Google Earth che rilascia anche il giorno preciso
            nel quale la foto &#232; stata scattata. Fare questo per quasi 4000 volte &#232; parecchio dispendioso in termini di tempo quindi per circa met&#224; delle BTS viene considerato il valore
            "medio" di 30 metri da terra che risulta essere una discreta approssimazione.<br>Il <em>modello digitale di elevazione</em> utilizzato (DEM) rappresentante l'orografia italiana con una risoluzione di 10 metri 
            &#232; stato reperito dal portale INGV <a href='https://tinitaly.pi.ingv.it/Download_Area1_1.html'>qui</a>.<br> Ottenere la direzione dei settori non &#232; stato certamente banale. Anche questi dati non vengono forniti in chiaro
            da nessun servizio, per questo &#232; stato necessario fare richieste ripetute in diverse posizioni per ogni BTS per ottenere una risoluzione angolare sufficiente.
        </p>
        <p class="texttitle">Come sono stati elaborati i dati?</p>
        <p class="textinfo">Ottenere i dati RAW &#232; certamente fondamentale ma questi non possono essere rappresentati su mappa senza la dovuta analisi.
            La maggior parte del tempo &#232; stato investito nel calcolo delle <em>heatmap</em> in formato GeoTIFF tramite il plugin <em>qgis-visibility-analysis</em> di QGIS.
            Le heatmap rappresentano la <em>depth below horizon</em>, ovvero un valore in metri che stima l'altezza alla quale dovremmo essere per vedere la BTS.
            Viene preso come riferimento il valore di 4 metri da terra (m slt) come altezza media di un'edificio e vengono considerati sia la rifrazione atmosferia, pari a 0.13, sia 
            la curvatura terrestre. Il raggio entro il quale viene considerata la copertura &#232; 15km, oltre questo valore le coperture sono rare ed esclusivamente con tecnologia <em>Eolowave</em> (30M).<br>
            L'elaborazione dei settori consiste nel raggruppare le query effettuate ed interpolando i valori a seconda della loro distanza angolare: valori di tecnologia uguale
            e con distanza angolare inferiore ai 15&#176; vengono considerati come unico settore; settori con angolo iniziale inferiore a 5&#176; o angolo finale superioe a 355&#176; vengono approssimati
            rispettivamente a 0&#176; e 360&#176;. 
        </p>
        <p class="texttitle">Approssimazioni, supposizioni e limiti di utilizzo</p>
        <p class="textinfo">Come gi&#224; scritto, l'approssimazione pi&#249; importante e grossolana consiste nel considerare, per circa met&#224; delle BTS, l'altezza media pari 30 metri,
            per ora non sembrerebbe influenzare troppo le coperture stimate ed &#232; importante sapere che l'eventuale errore influenza le coperture pi&#249; distanti.
            Una supposizione da tenere a mente quando si guarda la heatmap &#232; l'altezza media del posizionamento della BTS valutato in 4 metri. Nel caso in cui la discrepanza
            tra il valore stimato e quello effettivo di posizionamento della CPE sia apprezzabile, si considera di verificare il valore puntuale interrogando la heatmap.
            I valori della heatmap hanno un intervallo <br>[ -4, 5000 ], ma possiamo considerare come intevallo di lavoro [ -4, 100 ]; sono necessari alcuni esempi per spiegare
            dei casi limite di utilizzo della heatmap:<br><br>
            1. Edificio alto 10 metri e valore heatmap -4: Nessun problema, il valore -4 indica che non solo abbiamo copertura a 4m slt ma la abbiamo anche a 0m slt, quindi a 10m slt non avremo alcun problema.<br>
            2. Edificio alto 10 metri e valore heatmap 2: Il valore 2 indica che dobbiamo sollevarci di 2m rispetto al valore considerato (4m slt) per ottenere copertura. Nell'esempio in considerazione, avremo copertura a 6m slt, quindi a 10m non ci saranno problemi.<br>
            3. Edificio alto 4 metri e valore heatmap 0: Il valore 0 indica che il punto di inizio copertura &#232; pari alla supposizione di 4m slt. In questo caso ci troviamo in una situazione limite ed altri fattori andrebbero considerati (approssimazione altezza BTS, presenza di edifici ed ostacoli, distanza).<br>
            4. Edificio alto 10 metri e valore heatmap 50: In questo caso il valore di 50 ci indica che dobbiamo essere ad almeno 54m slt per avere visibilit&#224;. Trovandoci noi a 10m slt, una copertura &#232; estremamente improbabile. <br><br>
            Possiamo sintetizzare che la copertura pu&#242; essere rappresentata dalla funzione<br><em> c = e - (4 + h)</em> dove <em> e</em> rappresenta l'altezza di installazione della CPE e <em> h</em> il valore puntuale sulla heatmap; pi&#249; il risultato &#232; positivo e pi&#249; la visibilit&#224; &#232; garantita.<br><br>
            La presenza nella zona circostante di edifici/ostacoli che non sono tenuti in considerazione dal DEM INGV, prevalentemente strutture non naturali (palazzi, chiese, etc.) e boschi fitti riducono irrimediabilmente la precisione delle mappe.<br><br>
            Nella rappresentazione dei settori, vengono utilizzati dei semicerchi per approssimazione, in realt&#224; il range di copertura e la qualit&#224; del segnale diminuiscono man mano che ci si allontana dalla bisettrice del settore; chiaramente l'apprezzabilit&#224; di questa propriet&#224; dipende dall'estensione angolare del lobo coperto dalla BTS, dal <em>tilt</em> e da eventuali sovrapposizioni con altri settori;
            In caso di copertura nelle immediate vicinanze della BTS, la copertura &#232; sempre presente a prescindere dall'eventuale mancanza di settori. 
        </p>
        <p class="texttitle">Modifiche</p>
        <p class="textinfo">&#200; possibile effettuare modifiche in autonomia per quanto riguarda l'estensione dei settori tramite CTRL + tasto sinistro dopo aver selezionato una BTS. Questa combinazione inizier&#224; una query presso server esterni per la verifica puntuale della copertura.<br>
            In caso la copertura sia positiva e abbia una distanza angolare inferiore a 5&#176; rispetto al settore pi&#249; vicino con stessa tecnologia, il settore viene esteso fino al <em>bearing</em> in questione, arrotondato all'intero pi&#249; vicino.

        </p>
        
        <button id="close" class="close-button">Chiudi</button>
    </div>
      </div>  
</body>

</html>
<script src="https://unpkg.com/proj4"></script>
<script src="https://unpkg.com/georaster"></script>
<script src="https://unpkg.com/chroma-js"></script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://npmcdn.com/leaflet-geometryutil"></script>
<script src="https://unpkg.com/georaster-layer-for-leaflet/dist/georaster-layer-for-leaflet.min.js"></script>
<script src="./dist/leaflet.markercluster-src.js"></script>
<script src="./js/leaflet.sector.js"></script>
<script src="https://unpkg.com/geoblaze"></script>
<script src='https://unpkg.com/leaflet-arc/bin/leaflet-arc.min.js'></script>
<script src="js/map.js?v=234125454454145443335444555454375445453444444464214>"></script>
<script src="js/script.js?v=4442453554655556534553445634414234>"></script>
<script src="js/report.js?v=35555"></script>
<script src="js/research.help.js?v=54"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.2/jquery.min.js" integrity="sha512-tWHlutFnuG0C6nQRlpvrEhE4QpkG1nn2MOUMWmUeRePl4e3Aki0VB6W1v3oLjFtd0hVOtRQ9PHpSfN6u6/QXkQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="js/info.trigger.js?v=4"></script>